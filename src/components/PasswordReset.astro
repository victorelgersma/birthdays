---
import { pb } from '../lib/pocketbase'
---

<div class="max-w-md mx-auto mt-8 p-6 bg-white rounded-lg shadow-md">
  <h2 class="text-2xl font-bold mb-6">Reset Password</h2>
  <form id="resetForm" class="space-y-4">
    <div>
      <label for="email" class="block text-gray-700">Email:</label>
      <input
        type="email"
        id="email"
        name="email"
        required
        class="w-full border p-2 rounded focus:ring-blue-500 focus:border-blue-500"
      />
    </div>
    <button
      type="submit"
      class="w-full bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600"
    >
      Send Reset Link
    </button>
  </form>
  <p class="mt-4 text-center text-gray-600">
    Remember your password?
    <button id="showLoginBtn" class="text-blue-500 hover:underline"
      >Login</button
    >
  </p>
</div>

<script>
  import { pb } from '../lib/pocketbase'

  const form = document.getElementById('resetForm')
  const submitButton = form?.querySelector(
    'button[type="submit"]'
  ) as HTMLButtonElement

  form?.addEventListener('submit', async (e) => {
    e.preventDefault()
    const formData = new FormData(e.target as HTMLFormElement)
    const email = formData.get('email') as string

    try {
      submitButton.disabled = true
      submitButton.textContent = 'Sending...'

      await pb.collection('users').requestPasswordReset(email)

      // Show success message
      alert('Password reset link has been sent to your email!')

      // Return to login view
      document.getElementById('resetView')?.classList.add('hidden')
      document.getElementById('loginView')?.classList.remove('hidden')
    } catch (error) {
      console.error('Password reset failed:', error)
      alert('Failed to send reset link. Please check your email and try again.')
    } finally {
      submitButton.disabled = false
      submitButton.textContent = 'Send Reset Link'
    }
  })

  // Handle switch to login view
  document.getElementById('showLoginBtn')?.addEventListener('click', () => {
    document.getElementById('loginView')?.classList.remove('hidden')
    document.getElementById('resetView')?.classList.add('hidden')
  })
</script>
